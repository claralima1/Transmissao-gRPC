version: '3.8'

services:
  servidor:
    build:
      context: ./proto/servidor-python
      dockerfile: Dockerfile
    container_name: grpc-servidor-python
    ports:
      - "50051:50051"
    networks:
      - grpc-network
    environment:
      - PYTHONUNBUFFERED=1
    command: python server.py

  cliente:
    build:
      context: ./cliente-node
      dockerfile: Dockerfile
    container_name: grpc-cliente-node
    depends_on:
      - servidor
    networks:
      - grpc-network
    volumes:
      - ./proto:/app/proto:ro
    environment:
      - GRPC_SERVER=servidor:50051
    command: sh -c "sleep 2 && node cliente.js"

networks:
  grpc-network:
    driver: bridge
